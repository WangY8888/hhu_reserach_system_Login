<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>æ²³æµ·å¤§å­¦æ™ºæ…§ç ”ç©¶ç”Ÿç§‘ç ”ç³»ç»Ÿ</title>

  <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

  <style>
    /* ===============================
       å…¨å±€åŸºç¡€æ ·å¼
       è¯´æ˜ï¼šé‡ç½®é»˜è®¤é—´è·ã€å¯ç”¨ç›’æ¨¡å‹ã€è®¾ç½®é»˜è®¤å­—ä½“ä¸è‡ªå®šä¹‰é¼ æ ‡æŒ‡é’ˆã€‚
       =============================== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: "Microsoft YaHei", sans-serif;
      cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="30" height="40" viewBox="0 0 30 40"><path d="M1.5 1.5l5 15l2.5-7.5l7.5-2.5z" fill="white" stroke="%230348b0" stroke-width="1.5"/></svg>'), auto;
    }

    body {
      /* é¡µé¢ä¸»èƒŒæ™¯ï¼šæ ¡å¾½å›¾ç‰‡å±…ä¸­ä¸”é“ºæ»¡å¯è§†åŒºåŸŸ */
      overflow: auto;
      height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: #e0f7ff;
      background-image: url("æ²³æµ·æ ¡å¾½.png");
      background-repeat: no-repeat;
      background-position: center center;
      background-size: cover;
      background-color: transparent;
    }

    /* ===============================
       é¡¶éƒ¨å¯¼èˆªæ ï¼ˆå›ºå®šï¼‰
       è¯´æ˜ï¼šå›ºå®šä½ç½®ã€åŠé€æ˜èƒŒæ™¯ã€æ¨¡ç³Šæ•ˆæœã€å“åº”å¼éšè—å³ä¾§å¯¼èˆªã€‚ 
       =============================== */
    header {
      position: fixed;
      top: 0;
      width: 100%;
      height: 53.6px;
      background: rgba(255, 255, 255, 0.6);
      box-shadow: 0 1.34px 5.36px rgba(0, 0, 0, 0.4);
      display: flex;
      align-items: center;
      justify-content: flex-start;
      padding: 0 1.34%;
      backdrop-filter: blur(5.36px);
      z-index: 20;
      flex-wrap: wrap;
    }

    header h1 {
      position: relative;
      left: 10.05px;
      font-size: 18.76px;
      color: #0348b0;
      line-height: 46.9px;
      font-family: "Microsoft YaHei", "Segoe UI", "PingFang SC", sans-serif;
    }

    nav {
      position: absolute;
      display: flex;
      justify-content: space-between;
      right: 67px;
      gap: 6.7px;
    }

    nav a {
      margin-left: 40.2px;
      text-decoration: none;
      color: #033d94;
      font-weight: 600;
      transition: color 0.3s;
      font-size: 13.4px;
    }

    nav a:hover {
      color: #4e84e9;
    }

    /* ===============================
       ä¸»åŠŸèƒ½å¡ç‰‡æ ·å¼
       è¯´æ˜ï¼šå“åº”å¼ç½‘æ ¼ã€å¡ç‰‡æ‚¬æµ®æ•ˆæœä¸å…¥åœºåŠ¨ç”»ã€‚ 
       =============================== */
    main {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160.8px, 1fr));
      gap: 20.1px;
      width: 90%;
      max-width: 900px;
      max-height: 80.4px;
      z-index: 10;
      margin-top: 10px;
    }

    .card {
      background: #0348b0;
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 12.06px;
      backdrop-filter: blur(6.7px);
      box-shadow: 0 5.36px 13.4px rgba(0, 100, 255, 0.25);
      padding: 16.75px;
      text-align: center;
      transition: transform 0.3s, box-shadow 0.3s;
      cursor: pointer;
      animation: popIn 0.5s ease;
    }

    .card:hover {
      transform: translateY(-6.7px);
      box-shadow: 0 0 16.75px rgba(0, 113, 243, 0.5);
    }

    .card h3 {
      font-size: 13.4px;
      color: #ffffff;
      margin-bottom: 6.7px;
    }

    .card p {
      color: #ffffff;
      font-size: 11.39px;
    }

    /* å¼¹çª—å¡ç‰‡ï¼ˆæ·»åŠ å®éªŒ / è®ºæ–‡è¿›åº¦ / æ–‡çŒ®ï¼‰
       è¯´æ˜ï¼šç»Ÿä¸€æ ·å¼ã€åœ†è§’ã€é˜´å½±ã€æ»šåŠ¨å¤„ç†ï¼Œåˆå§‹ä¸ºéšè—ï¼ˆé€šè¿‡ JS æ˜¾ç¤ºï¼‰ã€‚
    */
    .newcard,
    .newcard2,
    .newcard4 {
      position: absolute;
      width: 53.6vw;
      max-width: 603px;
      height: auto;
      max-height: 70vh;
      overflow-y: auto;
      border: 1.675px solid #ffffff;
      background: #ffffff;
      display: none;
      border-radius: 33.5px;
      box-shadow: 0 0 16.75px rgba(0, 0, 0, 0.25);
      padding: 26.8px;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      font-size: 16.08px;
      animation: popIn 0.3s ease;
    }

    @keyframes popIn {
      from {
        transform: scale(0.8);
        opacity: 0;
      }

      to {
        transform: scale(1);
        opacity: 1;
      }
    }

    .newcard h2,
    .newcard2 h2,
    .newcard4 h2 {
      margin-bottom: 26.8px;
      color: #0348b0;
      font-size: 18.76px;
    }

    .newcard form,
    .newcard2 form,
    .newcard4 form {
      display: flex;
      flex-direction: column;
      gap: 10.05px;
      align-items: center;
      justify-content: center;
      margin: auto;
      text-align: left;
    }

    .newcard label,
    .newcard2 label,
    .newcard4 label {
      width: 60%;
      font-weight: bold;
      color: #033d94;
      text-align: left;
      font-size: 13.4px;
    }

    .newcard input,
    .newcard textarea,
    .newcard2 input,
    .newcard2 textarea,
    .newcard4 input,
    .newcard4 textarea {
      width: 60%;
      padding: 6.7px;
      border: 1.005px solid #acc3e3;
      border-radius: 5.36px;
      font-size: 12px;
    }

    .newcard textarea,
    .newcard2 textarea,
    .newcard4 textarea {
      resize: vertical;
      height: 67px;
      width: 60%;
    }

    .newcard button,
    .newcard2 button,
    .newcard4 button {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: row;
      margin-top: 5.36px;
      padding: 6.7px;
      border: none;
      border-radius: 5.36px;
      background-color: #0348b0;
      color: white;
      font-size: 12.06px;
      cursor: pointer;
      width: 20%;
      height: 33.5px;
      transition: background-color 0.3s;
    }

    .newcard button:hover,
    .newcard2 button:hover,
    .newcard4 button:hover {
      background-color: #022e70;
    }

    /* æ¶ˆæ¯æç¤ºï¼ˆé¡µé¢å³ä¸Šè§’ï¼‰
       è¯´æ˜ï¼šç”¨äºæ˜¾ç¤ºæˆåŠŸ/é”™è¯¯/ä¿¡æ¯æ€§æç¤ºï¼ŒJS æ§åˆ¶æ˜¾ç¤ºä¸éšè—ã€‚ */
    .message {
      position: fixed;
      top: 80px;
      right: 20px;
      padding: 12px 20px;
      border-radius: 5px;
      z-index: 1000;
      font-weight: bold;
      font-size: 14px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
      display: none;
    }

    .message.success {
      background-color: #4CAF50;
      color: white;
    }

    .message.error {
      background-color: #f44336;
      color: white;
    }

    .message.info {
      background-color: #2196F3;
      color: white;
    }

    /* æ—¥å†ä¸æ—¥å¿—åŒºåŸŸæ ·å¼
       è¯´æ˜ï¼šå·¦ä¾§æ—¥å†ã€å³ä¾§æ—¥å¿—ï¼›æ—¥å†å¸¦ç¿»æœˆæŒ‰é’®ã€å½“å¤©é«˜äº®ã€‚ */
    .calendar-log-container {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 26.8px;
      margin-top: 0px;
      margin-bottom: 50px;
      animation: popIn 0.3s ease;
    }

    #calendar-container {
      margin: 0;
      width: 214.4px;
      background: #f0f8ff;
      border-radius: 8.04px;
      padding: 6.7px;
      text-align: center;
      box-shadow: 0 3.35px 10.05px rgba(0, 0, 0, 0.2);
      border: 2px solid #0348b0;
    }

    #calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6.7px;
    }

    #calendar-header button {
      background: #0348b0;
      color: #fff;
      border: none;
      padding: 3.35px 6.7px;
      border-radius: 3.35px;
      cursor: pointer;
      font-size: 10.72px;
    }

    #calendar-header button:hover {
      background: #022e70;
    }

    #month-year {
      font-weight: bold;
      color: #0348b0;
      font-size: 12.06px;
    }

    .today {
      background: #0348b0;
      color: #ffffff;
      font-weight: bold;
      border-radius: 50%;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th,
    td {
      width: 14.28%;
      padding: 5.36px;
      text-align: center;
      font-size: 10.72px;
    }

    th {
      color: #0348b0;
      font-weight: bold;
    }

    td {
      cursor: pointer;
      border-radius: 50%;
      color: #0348b0;
      font-weight: bold;
    }

    td:hover {
      background: #0348b0;
      color: #fff;
    }

    /* å³ä¾§æ—¥å¿—é¢æ¿æ ·å¼ */
    #log-container {
      position: static;
      width: 234.5px;
      height: auto;
      min-height: 268px;
      background-color: #f0f8ff;
      border-radius: 8.04px;
      padding: 10.05px;
      box-shadow: 0 3.35px 10.05px rgba(0, 0, 0, 0.2);
      font-family: "Microsoft YaHei", sans-serif;
      border: 2px solid #0348b0;
    }

    #log-container h3 {
      color: #0348b0;
      text-align: center;
      margin-bottom: 10.05px;
      font-size: 14.74px;
    }

    .log-entry {
      margin-bottom: 13.4px;
      padding-bottom: 10.05px;
      border-bottom: 1px dashed #acc3e3;
    }

    .log-entry h4 {
      color: #033d94;
      margin-bottom: 5.36px;
      font-size: 12.06px;
    }

    .log-entry p {
      color: #333;
      font-size: 12px;
      line-height: 1.5;
    }

    .log-form textarea {
      width: 100%;
      height: 53.6px;
      padding: 6.7px;
      border: 1.005px solid #acc3e3;
      border-radius: 5.36px;
      font-family: "Microsoft YaHei", sans-serif;
      resize: vertical;
      margin-bottom: 6.7px;
      font-size: 10.72px;
    }

    .log-form button {
      background-color: #0348b0;
      color: white;
      border: none;
      padding: 5.36px 10.05px;
      border-radius: 5.36px;
      cursor: pointer;
      float: right;
      font-size: 10.72px;
    }

    .log-form button:hover {
      background-color: #022e70;
      transition: background-color 0.3s ease;
    }

    /* æ—¥å¿—åˆ—è¡¨ / æŸ¥çœ‹å™¨ */
    .log-viewer {
      width: 90%;
      max-height: 70vh;
      overflow-y: auto;
    }

    .log-filter {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 20px;
      padding: 10px;
      background: #f5f9ff;
      border-radius: 8px;
    }

    .log-filter label {
      width: auto;
      margin: 0;
    }

    .log-filter input {
      width: auto;
    }

    .log-filter button {
      width: auto;
      padding: 5px 10px;
      font-size: 12px;
    }

    .logs-list {
      margin-bottom: 20px;
    }

    .log-item {
      background: #f8fafc;
      border: 1px solid #e1e8f0;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 10px;
      transition: all 0.3s ease;
    }

    .log-item:hover {
      background: #eef4ff;
      transform: translateX(5px);
    }

    .log-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
      font-size: 12px;
    }

    .log-date {
      color: #0348b0;
      font-weight: bold;
    }

    .log-type {
      color: #666;
      background: #e1e8f0;
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 10px;
    }

    .log-content {
      /* ç»“åˆæ˜¾ç¤ºæ ·å¼ä¸æ»šåŠ¨é™åˆ¶ï¼šç”¨äºæ—¥å¿—æ–‡æœ¬ä¸å†å²è®°å½•æ˜¾ç¤º */
      margin-bottom: 13.4px;
      max-height: 201px;
      overflow-y: auto;
      color: #333;
      font-size: 14px;
      line-height: 1.5;
    }

    .log-actions {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
    }

    .log-actions button {
      width: auto;
      padding: 8px 15px;
      font-size: 12px;
    }

    #exportLogs {
      background: #28a745;
    }

    #exportLogs:hover {
      background: #218838;
    }

    #clearLogs {
      background: #dc3545;
    }

    #clearLogs:hover {
      background: #c82333;
    }

    /* æ³¢æµªåº•éƒ¨è£…é¥°ä¸åŠ¨ç”»ï¼ˆå›ºå®šåœ¨åº•éƒ¨ï¼Œä½œä¸ºè§†è§‰æ•ˆæœï¼‰ */
    .wave-container {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 200%;
      height: 147.4px;
      overflow: hidden;
      z-index: -1;
    }

    .wave {
      position: absolute;
      width: 200%;
      height: 134px;
      background: rgba(255, 255, 255, 0.15);
      border-radius: 100%;
      animation: waveMove 8s linear infinite;
    }

    .wave:nth-child(1) {
      bottom: 0;
      background: rgba(0, 180, 255, 0.35);
      animation-delay: 0s;
    }

    .wave:nth-child(2) {
      bottom: 13.4px;
      background: rgba(0, 120, 255, 0.25);
      animation-delay: -2s;
    }

    .wave:nth-child(3) {
      bottom: 20.1px;
      background: rgba(180, 189, 219, 0.2);
      animation-delay: -4s;
    }

    @keyframes waveMove {
      0% {
        transform: translateX(0);
      }

      100% {
        transform: translateX(-50%);
      }
    }

    /* ç‚¹å‡»æ¶Ÿæ¼ªæ•ˆæœï¼ˆJS åŠ¨æ€åˆ›å»º .ripple å…ƒç´ ï¼‰ */
    .ripple {
      position: absolute;
      border-radius: 50%;
      background-color: #0348b0ac;
      animation: rippleAnimation 1s forwards;
      pointer-events: none;
    }

    @keyframes rippleAnimation {
      0% {
        transform: scale(0);
        opacity: 1;
      }

      100% {
        transform: scale(1);
        opacity: 0;
      }
    }

    /* å›¾æ ‡ä¸ logo çš„åŸºç¡€æ ·å¼ */
    .fas {
      font-size: 13.4px;
    }

    #logoImg img {
      width: 33.5px;
      height: 33.5px;
    }
  </style>
</head>

<body>
  <!-- æ¶ˆæ¯æç¤ºå®¹å™¨ï¼ˆç”± JS æ§åˆ¶æ˜¾ç¤ºï¼‰ -->
  <div id="message" class="message"></div>

  <!-- é¡¶éƒ¨å¯¼èˆªæ ï¼šæ ¡å¾½ + ç³»ç»Ÿæ ‡é¢˜ + å³ä¾§ç”¨æˆ·å¯¼èˆª -->
  <header>
    <div id="logoImg">
      <img src="æ²³æµ·å¤§å­¦æ ¡å¾½.png" width="33.5" height="33.5" alt="æ²³æµ·å¤§å­¦æ ¡å¾½">
    </div>

    <h1>æ²³æµ·å¤§å­¦æ™ºæ…§ç ”ç©¶ç”Ÿç§‘ç ”ç³»ç»Ÿ</h1>

    <div id="app">
      <nav>
        <div id="navRight">
          <a href=" "><i class="fas fa-home"></i> ä¸»é¡µ</a>
          <a href="#"><i class="fas fa-user"></i> <u>{{ username }}</u></a>
          <a href="#"><i class="fas fa-sign-out-alt"></i> ç™»å‡º</a>
        </div>
      </nav>
    </div>
  </header>

  <!-- æ—¥å†ä¸ä¸ªäººæ—¥å¿—åŒºåŸŸï¼ˆå·¦ï¼šæ—¥å†ï¼Œå³ï¼šæ—¥å¿—ï¼‰ -->
  <div class="calendar-log-container">
    <div id="calendar-container">
      <div id="calendar-header">
        <button id="prev-month">&lt;</button>
        <div id="month-year"></div>
        <button id="next-month">&gt;</button>
      </div>

      <table id="calendar-table">
        <thead>
          <tr>
            <th>æ—¥</th>
            <th>ä¸€</th>
            <th>äºŒ</th>
            <th>ä¸‰</th>
            <th>å››</th>
            <th>äº”</th>
            <th>å…­</th>
          </tr>
        </thead>

        <tbody id="calendar-body"></tbody>
      </table>
    </div>

    <div id="log-container">
      <h3>ä¸ªäººæ—¥å¿—</h3>

      <div class="log-content">
        <div class="log-entry">
          <h4>ä»Šæ—¥è®¡åˆ’</h4>
          <p>è¯·åœ¨æ­¤è®°å½•æ‚¨ä»Šå¤©çš„å­¦ä¹ å’Œç ”ç©¶è®¡åˆ’...</p>
        </div>

        <div class="log-entry">
          <h4>å­¦ä¹ ç¬”è®°</h4>
          <p>è®°å½•æ‚¨çš„å­¦ä¹ å¿ƒå¾—å’Œç ”ç©¶è¿›å±•...</p>
        </div>

        <div class="log-entry">
          <h4>é—®é¢˜ä¸æ€è€ƒ</h4>
          <p>è®°å½•åœ¨ç ”ç©¶è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜å’Œæ€è€ƒ...</p>
        </div>
      </div>

      <div class="log-form">
        <textarea id="log-input" placeholder="å†™ä¸‹æ‚¨çš„æ—¥å¿—..."></textarea>
        <button id="save-log">ä¿å­˜æ—¥å¿—</button>
      </div>
    </div>
  </div>

  <!-- ä¸»åŠŸèƒ½å¡ç‰‡åŒºï¼šä¸‰ä¸ªå¡ç‰‡åˆ†åˆ«å¯¹åº”å®éªŒè®°å½• / è®ºæ–‡è¿›åº¦ / æ–‡çŒ®ç®¡ç† -->
  <main>
    <div class="card">
      <h3>ğŸ“Œ æ·»åŠ å®éªŒè®°å½•</h3>
      <p>è®°å½•ä»Šå¤©çš„å®éªŒæ•°æ®ä¸ç»“æœã€‚</p>
    </div>

    <div class="card">
      <h3>ğŸ“„ å¡«å†™è®ºæ–‡è¿›åº¦</h3>
      <p>æŸ¥çœ‹è®ºæ–‡æ’°å†™è¿›åº¦å’Œå½“å‰ç« èŠ‚å®Œæˆæƒ…å†µã€‚</p>
    </div>

    <div class="card">
      <h3>ğŸ“š ç®¡ç†æ–‡çŒ®åº“</h3>
      <p>æ·»åŠ ã€æŸ¥çœ‹æˆ–æ ‡è®°ä½ çš„æ–‡çŒ®èµ„æ–™ã€‚</p>
    </div>
  </main>

  <!-- å¼¹çª—ï¼šå®éªŒè®°å½• -->
  <div class="newcard" id="newcard1">
    <h2 id="newcard1-title">æ·»åŠ å®éªŒè®°å½•</h2>

    <form id="addExperimentForm">
      <label for="expName">å®éªŒåç§°ï¼š</label>
      <input type="text" id="expName" name="expName" placeholder="è¯·è¾“å…¥å®éªŒåç§°" required>

      <label for="expDate">å®éªŒæ—¥æœŸï¼š</label>
      <input type="date" id="expDate" name="expDate" required>

      <label for="expData">å®éªŒæ•°æ®ï¼š</label>
      <textarea id="expData" name="expData" placeholder="è¯·è¾“å…¥å®éªŒæ•°æ®æˆ–ç»“æœ"></textarea>

      <label for="expNote">å®éªŒå¤‡æ³¨ï¼š</label>
      <textarea id="expNote" name="expNote" placeholder="è¾“å…¥å®éªŒè¯´æ˜æˆ–é—®é¢˜"></textarea>

      <button type="submit">ä¿å­˜å®éªŒè®°å½•</button>
      <button type="button" id="backBtn">è¿”å›ä¸»é¡µ</button>
    </form>
  </div>

  <!-- å¼¹çª—ï¼šè®ºæ–‡è¿›åº¦ -->
  <div class="newcard2" id="newcard2">
    <h2 id="newcard2-title">å¡«å†™è®ºæ–‡è¿›åº¦</h2>

    <form id="progressForm">
      <label for="progressSummary">è¿›åº¦æ¦‚è¿°ï¼š</label>
      <input type="text" id="progressSummary" name="progressSummary" placeholder="è¯·è¾“å…¥è¿›åº¦æ¦‚è¿°ï¼ˆ1-3å¥ï¼‰" required>

      <label for="completedTasks">å…·ä½“å®Œæˆé¡¹ï¼š</label>
      <input type="text" id="completedTasks" name="completedTasks" placeholder="æ ‡å¥½åºå·ï¼Œç”¨çŸ­å¥å†™å‡º" required>

      <label for="output">ç»“æœäº§å‡ºï¼š</label>
      <textarea id="output" name="output" placeholder="è¯·è¾“å…¥ç»“æœäº§å‡ºï¼ˆ1-3å¥ï¼‰"></textarea>

      <label for="issues">é‡åˆ°çš„é—®é¢˜ï¼š</label>
      <textarea id="issues" name="issues" placeholder="è¯·è¾“å…¥é‡åˆ°çš„é—®é¢˜ï¼ˆ1-3å¥ï¼‰"></textarea>

      <label for="nextPlan">ä¸‹é˜¶æ®µè®¡åˆ’ï¼š</label>
      <textarea id="nextPlan" name="nextPlan" placeholder="è¯·è¾“å…¥ä¸‹é˜¶æ®µè®¡åˆ’ï¼ˆ1-3å¥ï¼‰"></textarea>

      <button type="submit">ä¿å­˜è¿›åº¦</button>
      <button type="button" id="backBtn2">è¿”å›ä¸»é¡µ</button>
    </form>
  </div>

  <!-- å¼¹çª—ï¼šæ–‡çŒ®ç®¡ç†ï¼ˆå·²ç§»é™¤æ–‡ä»¶ä¸Šä¼  UIï¼‰ -->
  <div class="newcard4" id="newcard4">
    <h2 id="newcard4-title">ç®¡ç†æ–‡çŒ®åº“</h2>

    <form id="literatureForm">
      <label for="title">æ–‡çŒ®æ ‡é¢˜ï¼š</label>
      <input type="text" id="title" name="title" placeholder="è¯·è¾“å…¥æ–‡çŒ®æ ‡é¢˜" required>

      <label for="authors">ä½œè€…ï¼š</label>
      <input type="text" id="authors" name="authors" placeholder="è¯·è¾“å…¥ä½œè€…ï¼ˆå¤šä¸ªä½œè€…ç”¨é€—å·åˆ†éš”ï¼‰" required>

      <label for="journal">æœŸåˆŠ/ä¼šè®®ï¼š</label>
      <input type="text" id="journal" name="journal" placeholder="å‘è¡¨çš„æœŸåˆŠæˆ–ä¼šè®®åç§°" required>

      <label for="year">å¹´ä»½ï¼š</label>
      <input type="number" id="year" name="year" placeholder="ä¾‹å¦‚ï¼š2025" min="1900" max="2100" required>

      <label for="keywords">å…³é”®è¯ï¼š</label>
      <input type="text" id="keywords" name="keywords" placeholder="è¯·è¾“å…¥å…³é”®è¯ï¼Œç”¨é€—å·åˆ†éš”">

      <label for="abstract">æ‘˜è¦ï¼š</label>
      <textarea id="abstract" name="abstract" placeholder="è¯·è¾“å…¥æ–‡çŒ®æ‘˜è¦ï¼ˆ1-5å¥ï¼‰"></textarea>

      <label for="link">æ–‡çŒ®é“¾æ¥ï¼š</label>
      <input type="url" id="link" name="link" placeholder="æ–‡çŒ®åœ¨çº¿é“¾æ¥æˆ– DOI">

      <label for="notes">å¤‡æ³¨ï¼š</label>
      <textarea id="notes" name="notes" placeholder="è¯·è¾“å…¥å¤‡æ³¨ä¿¡æ¯"></textarea>

      <button type="submit">ä¿å­˜æ–‡çŒ®</button>
      <button type="button" id="backBtn4">è¿”å›ä¸»é¡µ</button>
    </form>
  </div>

  <!-- æ³¢æµªåŠ¨ç”»å±‚ï¼ˆè§†è§‰è£…é¥°ï¼‰ -->
  <div class="wave-container">
    <div class="wave"></div>
    <div class="wave"></div>
    <div class="wave"></div>
  </div>

  <!-- ===============================
       JavaScript åŠŸèƒ½éƒ¨åˆ†ï¼ˆä¿æŒåŸæœ‰åŠŸèƒ½ä¸é€»è¾‘ï¼Œä¸åšåŠŸèƒ½æ€§ä¿®æ”¹ï¼‰
       è¯´æ˜ï¼šä½¿ç”¨åŸæœ‰çš„äº‹ä»¶ç»‘å®šã€åç«¯äº¤äº’æ¥å£ï¼ˆæœ¬åœ°å¼€å‘æ¥å£ï¼‰ã€ä»¥åŠé¡µé¢äº¤äº’é€»è¾‘ã€‚
       =============================== -->

  <script>
    // Vue å®ä¾‹ï¼šç»‘å®šé¡¶éƒ¨ç”¨æˆ·åæ˜¾ç¤ºï¼ˆä» sessionStorage ä¸­è¯»å–ï¼‰
    new Vue({
      el: "#app",
      data: {
        username: sessionStorage.getItem('username') || 'æœªç™»å½•'
      }
    });
    const BASE_URL = "https://hhu-reserach-system.onrender.com";
    // æ˜¾ç¤ºé¡µé¢å³ä¸Šè§’çš„æ¶ˆæ¯æç¤ºï¼ˆæˆåŠŸ/é”™è¯¯/ä¿¡æ¯ï¼‰
    function showMessage(message, type) {
      const messageEl = document.getElementById('message');
      messageEl.textContent = message;
      messageEl.className = 'message ' + type;
      messageEl.style.display = 'block';

      setTimeout(() => {
        messageEl.style.display = 'none';
      }, 3000);
    }

    // æ£€æµ‹çª—å£æ˜¯å¦æœ€å¤§åŒ–ï¼Œç”¨äºæ§åˆ¶å³ä¾§å¯¼èˆªåœ¨éæœ€å¤§åŒ–æ—¶éšè—
    function isWindowMaximized() {
      return (
        window.outerWidth === screen.availWidth &&
        window.outerHeight === screen.availHeight
      );
    }

    function updateNavByWindowState() {
      const navRight = document.getElementById('navRight');
      if (!navRight) return;

      if (!isWindowMaximized()) {
        navRight.style.display = 'none';
      } else {
        navRight.style.display = 'flex';
      }
    }

    window.addEventListener('load', updateNavByWindowState);
    window.addEventListener('resize', updateNavByWindowState);
    window.addEventListener('focus', updateNavByWindowState);

    // ç‚¹å‡»é¡µé¢ä»»æ„ä½ç½®åˆ›å»ºæ¶Ÿæ¼ªç‰¹æ•ˆï¼ˆJS åŠ¨æ€åˆ›å»º .ripple å…ƒç´ ï¼‰
    document.body.addEventListener('click', function (e) {
      const ripple = document.createElement('div');
      ripple.classList.add('ripple');

      const x = e.clientX;
      const y = e.clientY;

      ripple.style.left = `${x - 50}px`;
      ripple.style.top = `${y - 50}px`;

      const size = 80;
      ripple.style.width = `${size}px`;
      ripple.style.height = `${size}px`;

      document.body.appendChild(ripple);

      setTimeout(() => {
        ripple.remove();
      }, 800);
    });

    // ç™»å‡ºï¼šç§»é™¤ sessionStorage å¹¶è·³è½¬åˆ°ç™»å½•é¡µ
    document.querySelector('a[href="#"]:last-child').addEventListener('click', function (e) {
      e.preventDefault();
      sessionStorage.removeItem('username');
      window.location.href = 'https://login-mbxl.onrender.com';
    });

    // å¡ç‰‡ç‚¹å‡»é€»è¾‘ï¼šç‚¹å‡»å¡ç‰‡åéšè—ä¸»å¡ç‰‡å¹¶æ˜¾ç¤ºå¯¹åº”å¼¹çª—ï¼ŒåŒæ—¶éšè—æ—¥å†/æ—¥å¿—åŒº
    const newcard1 = document.getElementById('newcard1');
    const newcard2 = document.getElementById('newcard2');

    document.querySelectorAll('.card').forEach((card, index) => {
      if (index === 0) {
        card.addEventListener('click', () => {
          document.querySelectorAll('.card').forEach(c => c.style.display = 'none');
          newcard1.style.display = 'block';
          document.querySelector('.calendar-log-container').style.display = 'none';
        });
      }
      else if (index === 1) {
        card.addEventListener('click', () => {
          document.querySelectorAll('.card').forEach(c => c.style.display = 'none');
          newcard2.style.display = 'block';
          document.querySelector('.calendar-log-container').style.display = 'none';
        });
      }
      else if (index === 2) {
        card.addEventListener('click', () => {
          document.querySelectorAll('.card').forEach(c => c.style.display = 'none');
          document.getElementById('newcard4').style.display = 'block';
          document.querySelector('.calendar-log-container').style.display = 'none';
        });
      }
    });

    // è¿”å›æŒ‰é’®ï¼šä»å¼¹çª—è¿”å›åˆ°ä¸»é¡µè§†å›¾
    document.body.addEventListener('click', function (e) {
      if (e.target.id === 'backBtn') {
        document.querySelectorAll('.card').forEach(c => c.style.display = 'block');
        newcard1.style.display = 'none';
        document.querySelector('.calendar-log-container').style.display = 'flex';
      } else if (e.target.id === 'backBtn2') {
        document.querySelectorAll('.card').forEach(c => c.style.display = 'block');
        newcard2.style.display = 'none';
        document.querySelector('.calendar-log-container').style.display = 'flex';
      } else if (e.target.id === 'backBtn4') {
        document.querySelectorAll('.card').forEach(c => c.style.display = 'block');
        document.getElementById('newcard4').style.display = 'none';
        document.querySelector('.calendar-log-container').style.display = 'flex';
      }
    });

    /* ====== å®éªŒè®°å½•ä¿å­˜ï¼ˆä¸åç«¯äº¤äº’ï¼‰
       è¯´æ˜ï¼šå°†å®éªŒæ•°æ® POST åˆ°æœ¬åœ°å¼€å‘æ¥å£ /addExperimentï¼›ä¿å­˜æˆåŠŸæ—¶ä¼šåˆ·æ–°å†å²åˆ—è¡¨ã€‚
    */
    function saveExperiment() {
      const expName = document.getElementById('expName').value;
      const expDate = document.getElementById('expDate').value;
      const expData = document.getElementById('expData').value;
      const expNote = document.getElementById('expNote').value;

      const username = sessionStorage.getItem('username');
      if (!username) {
        alert('æœªæ£€æµ‹åˆ°ç™»å½•ç”¨æˆ·ï¼Œè¯·å…ˆç™»å½•');
        return;
      }

      fetch(`${BASE_URL}/addExperiment`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username, expName, expDate, expData, expNote })
      })
        .then(res => res.json())
        .then(data => {
          if (data.success) {
            alert('å®éªŒè®°å½•ä¿å­˜æˆåŠŸï¼ï¼ˆID: ' + data.experimentId + 'ï¼‰');
            document.getElementById('addExperimentForm').reset();
            document.querySelectorAll('.card').forEach(c => c.style.display = 'block');
            document.getElementById('newcard1').style.display = 'none';
          } else {
            console.error(data);
            alert('å®éªŒè®°å½•ä¿å­˜å¤±è´¥ï¼š' + (data.reason || data.error || 'unknown'));
          }
        })
        .catch(err => {
          console.error(err);
          alert('ä¿å­˜å‡ºé”™ï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°');
        });
    }

    // ====== å®éªŒå†å²ï¼šæ‹‰å–å¹¶æ¸²æŸ“åˆ°å¼¹çª—å†…ï¼ˆæœ€è¿‘è®°å½•ä¼˜å…ˆæ˜¾ç¤ºï¼‰ ======
    async function loadExperimentList() {
      const username = sessionStorage.getItem('username') || localStorage.getItem('username');
      if (!username) {
        return;
      }

      try {
        const res = await fetch('http://localhost:3000/getExperiments?username=' + encodeURIComponent(username));
        const data = await res.json();
        if (!data.success) {
          console.warn('æ‹‰å–å®éªŒè®°å½•å¤±è´¥', data);
          return;
        }

        renderExperimentHistory(data.data || []);
      } catch (err) {
        console.error('åŠ è½½å®éªŒè®°å½•å‡ºé”™ï¼š', err);
      }
    }

    function renderExperimentHistory(list) {
      const containerId = 'experimentHistoryContainer';
      let container = document.getElementById(containerId);
      const parent = document.getElementById('newcard1');
      if (!parent) return;

      if (!container) {
        container = document.createElement('div');
        container.id = containerId;
        container.style.width = '80%';
        container.style.margin = '20px auto';
        container.style.padding = '12px';
        container.style.borderTop = '1px dashed #acc3e3';
        container.style.textAlign = 'left';
        container.style.color = '#033d94';
        parent.appendChild(container);
      }

      container.innerHTML = '<h3 style="color:#0348b0;margin-bottom:8px;">å†å²å®éªŒè®°å½•ï¼ˆæœ€è¿‘ï¼‰</h3>';

      if (!list || list.length === 0) {
        const p = document.createElement('p');
        p.textContent = 'æš‚æ— å®éªŒè®°å½•ã€‚';
        p.style.color = '#666';
        container.appendChild(p);
        return;
      }

      const maxShow = 10;
      list.slice(0, maxShow).forEach(item => {
        const entry = document.createElement('div');
        entry.style.padding = '8px 0';
        entry.style.borderBottom = '1px solid #eee';

        const title = document.createElement('div');
        title.style.fontWeight = '700';
        title.style.marginBottom = '4px';

        let dateStr = '';
        if (item.expDate) {
          dateStr = ' ' + (item.expDate.includes('T') ? item.expDate.split('T')[0] : item.expDate);
        } else if (item.created_at) {
          dateStr = ' ' + (item.created_at.includes('T') ? item.created_at.split('T')[0] : item.created_at);
        }

        title.textContent = `${item.expName || '(æ— åç§°)'}${dateStr}`;

        const small = document.createElement('div');
        small.style.fontSize = '13px';
        small.style.color = '#333';
        small.innerHTML = `\n      <div><strong>æ•°æ®ï¼š</strong>${escapeHtml(item.expData || '-')}</div>\n      <div><strong>å¤‡æ³¨ï¼š</strong>${escapeHtml(item.expNote || '-')}</div>\n      <div style="margin-top:6px;"><strong>IDï¼š</strong>${item.id}</div>\n    `;

        entry.appendChild(title);
        entry.appendChild(small);
        container.appendChild(entry);
      });

      if (list.length > maxShow) {
        const more = document.createElement('div');
        more.style.textAlign = 'center';
        more.style.marginTop = '8px';
        more.innerHTML = `<small style="color:#666">... å…± ${list.length} æ¡å†å²ï¼ˆä»…æ˜¾ç¤ºæœ€è¿‘ ${maxShow} æ¡ï¼‰</small>`;
        container.appendChild(more);
      }
    }

    // æ‰“å¼€ "æ·»åŠ å®éªŒè®°å½•" æ—¶å»¶è¿Ÿæ‹‰å–å†å²ï¼Œä»¥ä¿è¯å¼¹çª—å·²æ˜¾ç¤º
    const cardFirst = document.querySelectorAll('.card')[0];
    if (cardFirst) {
      cardFirst.addEventListener('click', () => {
        setTimeout(loadExperimentList, 120);
      });
    }

    // è¦†å†™ saveExperimentï¼Œä¿æŒåŸæœ‰åŠŸèƒ½å¹¶åœ¨ä¿å­˜æˆåŠŸååˆ·æ–°å†å²åˆ—è¡¨
    const oldSaveExperiment = window.saveExperiment;
    window.saveExperiment = async function () {
      if (typeof oldSaveExperiment === 'function') {
        const username = sessionStorage.getItem('username') || localStorage.getItem('username');
        const expName = document.getElementById('expName')?.value || '';
        const expDate = document.getElementById('expDate')?.value || '';
        const expData = document.getElementById('expData')?.value || '';
        const expNote = document.getElementById('expNote')?.value || '';

        try {
          const res = await fetch(`${BASE_URL}/addExperiment`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ username, expName, expDate, expData, expNote })
          });

          const data = await res.json();
          if (data.success) {
            alert('å®éªŒè®°å½•ä¿å­˜æˆåŠŸï¼');
            // ä¿å­˜æˆåŠŸååˆ·æ–°å†å²åˆ—è¡¨
            await loadExperimentList();
          } else {
            alert('ä¿å­˜å¤±è´¥ï¼š' + (data.error || data.reason || 'æœªçŸ¥é”™è¯¯'));
          }
        } catch (e) {
          console.error(e);
          alert('è¯·æ±‚å‡ºé”™');
        }
      }
    };

    const form = document.getElementById('addExperimentForm');
    if (form) {
      form.addEventListener('submit', function (e) {
        e.preventDefault();
        saveExperiment();
      });
    } else {
      console.error('æ²¡æ‰¾åˆ°è¡¨å• addExperimentForm');
    }

    /* ====== æ—¥å†åŠŸèƒ½ï¼šæ¸²æŸ“å½“å‰æœˆä»½å¹¶æ”¯æŒç¿»æœˆ ======
       è¯´æ˜ï¼šæ¸²æŸ“å•æœˆæ—¥å†å¹¶å°†å½“å¤©æ ·å¼åŠ ä¸Š .today ç±»ã€‚ */
    const monthYear = document.getElementById("month-year");
    const calendarBody = document.getElementById("calendar-body");
    let today = new Date();
    let currentMonth = today.getMonth();
    let currentYear = today.getFullYear();

    function renderCalendar(month, year) {
      const firstDay = new Date(year, month, 1).getDay();
      const daysInMonth = new Date(year, month + 1, 0).getDate();
      monthYear.textContent = `${year}å¹´ ${month + 1}æœˆ`;

      calendarBody.innerHTML = "";
      let date = 1;

      for (let i = 0; i < 6; i++) {
        let row = document.createElement("tr");

        for (let j = 0; j < 7; j++) {
          let cell = document.createElement("td");

          if (i === 0 && j < firstDay) {
            cell.textContent = "";
          } else if (date > daysInMonth) {
            cell.textContent = "";
          } else {
            cell.textContent = date;
            if (date === today.getDate() && month === today.getMonth() && year === today.getFullYear()) {
              cell.classList.add("today");
            }
            date++;
          }

          row.appendChild(cell);
        }

        calendarBody.appendChild(row);
      }
    }

    document.getElementById("prev-month").addEventListener("click", () => {
      currentMonth--;
      if (currentMonth < 0) { currentMonth = 11; currentYear--; }
      renderCalendar(currentMonth, currentYear);
    });

    document.getElementById("next-month").addEventListener("click", () => {
      currentMonth++;
      if (currentMonth > 11) { currentMonth = 0; currentYear++; }
      renderCalendar(currentMonth, currentYear);
    });

    renderCalendar(currentMonth, currentYear);

    /* ====== è®ºæ–‡è¿›åº¦ï¼ˆæäº¤ä¸å†å²æ‹‰å–ï¼‰
       è¯´æ˜ï¼šæäº¤è¿›åº¦åˆ° /saveProgressï¼Œæ‹‰å–å†å²åˆ°å¼¹çª—å†…æ˜¾ç¤ºã€‚ */
    (function () {
      const progressForm = document.getElementById('progressForm');

      if (progressForm) {
        progressForm.addEventListener('submit', function (e) {
          e.preventDefault();
          submitThesisProgress();
        });
      }

      async function submitThesisProgress() {
        const username = sessionStorage.getItem('username') || localStorage.getItem('username');
        if (!username) {
          alert('æœªæ£€æµ‹åˆ°ç™»å½•ç”¨æˆ·ï¼Œè¯·å…ˆç™»å½•');
          return;
        }

        const progressSummary = document.getElementById('progressSummary').value.trim();
        const completedItems = document.getElementById('completedTasks').value.trim();
        const resultOutput = document.getElementById('output').value.trim();
        const problemsEncountered = document.getElementById('issues').value.trim();
        const nextPlan = document.getElementById('nextPlan').value.trim();

        if (!progressSummary) {
          alert('è¯·å¡«å†™è¿›åº¦æ¦‚è¿°');
          return;
        }

        const payload = {
          username,
          progressSummary,
          completedItems,
          resultOutput,
          problemsEncountered,
          nextPlan
        };

        try {
          const res = await fetch(`${BASE_URL}/saveProgress`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
          });

          const data = await res.json();
          if (data.success) {
            alert('è¿›åº¦ä¿å­˜æˆåŠŸï¼ˆID:' + data.progressId + 'ï¼‰');
            progressForm.reset();
            document.querySelectorAll('.card').forEach(c => c.style.display = 'block');
            document.getElementById('newcard2').style.display = 'none';
            loadProgressList();
          } else {
            alert('ä¿å­˜å¤±è´¥ï¼š' + (data.reason || data.error || 'unknown'));
          }
        } catch (err) {
          console.error('æäº¤è¿›åº¦å‡ºé”™ï¼š', err);
          alert('æäº¤å‡ºé”™ï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°');
        }
      }

      async function loadProgressList() {
        const username = sessionStorage.getItem('username') || localStorage.getItem('username');
        if (!username) return;

        try {
          const res = await fetch(`${BASE_URL}/getProgress?username=` + encodeURIComponent(username));
          const data = await res.json();
          if (!data.success) return;
          renderProgressHistory(data.data || []);
        } catch (err) {
          console.error('æ‹‰å–å†å²å‡ºé”™ï¼š', err);
        }
      }

      function renderProgressHistory(list) {
        const containerId = 'progressHistoryContainer';
        let container = document.getElementById(containerId);
        const parent = document.getElementById('newcard2');
        if (!parent) return;
        if (!container) {
          container = document.createElement('div');
          container.id = containerId;
          container.style.width = '80%';
          container.style.margin = '20px auto';
          container.style.padding = '12px';
          container.style.borderTop = '1px dashed #acc3e3';
          container.style.textAlign = 'left';
          container.style.color = '#033d94';
          parent.appendChild(container);
        }

        container.innerHTML = '<h3 style="color:#0348b0;margin-bottom:8px;">å†å²è¿›åº¦ï¼ˆæœ€è¿‘ï¼‰</h3>';

        if (!list || list.length === 0) {
          const p = document.createElement('p'); p.textContent = 'æš‚æ— å†å²è¿›åº¦ã€‚'; p.style.color = '#666'; container.appendChild(p); return;
        }

        const maxShow = 10;
        list.slice(0, maxShow).forEach(item => {
          const entry = document.createElement('div');
          entry.style.padding = '8px 0';
          entry.style.borderBottom = '1px solid #eee';

          const title = document.createElement('div');
          title.style.fontWeight = '700';
          title.style.marginBottom = '4px';
          const dateStr = item.created_at ? (' ' + item.created_at.split('T')[0]) : '';
          title.textContent = `${item.progress_summary || '(æ— æ¦‚è¿°)'}${dateStr}`;

          const small = document.createElement('div');
          small.style.fontSize = '13px';
          small.style.color = '#333';
          small.innerHTML = `\n        <div><strong>å®Œæˆé¡¹ï¼š</strong>${(item.completed_items || '-')}</div>\n        <div><strong>ç»“æœï¼š</strong>${(item.result_output || '-')}</div>\n        <div><strong>é—®é¢˜ï¼š</strong>${(item.problems_encountered || '-')}</div>\n        <div><strong>ä¸‹é˜¶æ®µï¼š</strong>${(item.next_plan || '-')}</div>\n      `;

          entry.appendChild(title); entry.appendChild(small);
          container.appendChild(entry);
        });

        if (list.length > maxShow) {
          const more = document.createElement('div');
          more.style.textAlign = 'center';
          more.style.marginTop = '8px';
          more.innerHTML = `<small style="color:#666">... å…± ${list.length} æ¡å†å²ï¼ˆä»…æ˜¾ç¤ºæœ€è¿‘ ${maxShow} æ¡ï¼‰</small>`;
          container.appendChild(more);
        }
      }

      const cardSecond = document.querySelectorAll('.card')[1];
      if (cardSecond) {
        cardSecond.addEventListener('click', () => {
          setTimeout(loadProgressList, 120);
        });
      }
    })();

    /* ====== æ–‡çŒ®ç®¡ç†ï¼ˆä¿å­˜ä¸å†å²æ‹‰å–ï¼‰
       è¯´æ˜ï¼šå»é™¤æ–‡ä»¶ä¸Šä¼ ç›¸å…³ UIï¼Œå½“å‰ä»¥ JSON å½¢å¼æäº¤æ–‡çŒ®å…ƒä¿¡æ¯åˆ° /addLiteratureã€‚
    */
    async function saveLiterature() {
      const title = document.getElementById('title').value.trim();
      const authors = document.getElementById('authors').value.trim();
      const journal = document.getElementById('journal').value.trim();
      const yearVal = document.getElementById('year').value;
      const keywords = document.getElementById('keywords').value.trim();
      const abstractTxt = document.getElementById('abstract').value.trim();
      const link = document.getElementById('link').value.trim();
      const notes = document.getElementById('notes').value.trim();

      const username = sessionStorage.getItem('username') || localStorage.getItem('username');
      if (!username) {
        showMessage('æœªæ£€æµ‹åˆ°ç™»å½•ç”¨æˆ·ï¼Œè¯·å…ˆç™»å½•', 'error');
        return;
      }

      if (!title || !authors) {
        showMessage('è¯·å¡«å†™æ–‡çŒ®æ ‡é¢˜å’Œä½œè€…', 'error');
        return;
      }

      try {
        showMessage('æ­£åœ¨ä¿å­˜æ–‡çŒ®...', 'info');

        const payload = {
          username,
          title,
          authors: authors,
          journal: journal,
          year: yearVal ? parseInt(yearVal, 10) : null,
          keywords: keywords,
          abstract: abstractTxt,
          link: link,
          notes: notes
        };

        console.log('å‘é€æ–‡çŒ®æ•°æ®:', payload);

        const response = await fetch(`${BASE_URL}/addLiterature`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json;charset=utf-8'
          },

          body: JSON.stringify(payload)
        });

        const data = await response.json();

        if (data && data.success) {
          showMessage('æ–‡çŒ®ä¿å­˜æˆåŠŸï¼æ–‡çŒ®ID: ' + data.literatureId, 'success');
          document.getElementById('literatureForm').reset();

          // ä½¿ç”¨å»¶è¿Ÿä¿æŒæ—¢æœ‰ä½“éªŒï¼šçŸ­æš‚æ˜¾ç¤ºæˆåŠŸæç¤ºåè¿”å›ä¸»é¡µ
          setTimeout(() => {
            document.querySelectorAll('.card').forEach(c => c.style.display = 'block');
            document.getElementById('newcard4').style.display = 'none';
            document.querySelector('.calendar-log-container').style.display = 'flex';
          }, 1500);

          setTimeout(loadLiteratureList, 300);
        } else {
          const errorMsg = data && data.error ? data.error : 'æœªçŸ¥é”™è¯¯';
          showMessage('ä¿å­˜å¤±è´¥ï¼š' + errorMsg, 'error');
        }
      } catch (err) {
        console.error('æäº¤æ–‡çŒ®å‡ºé”™ï¼š', err);
        showMessage('ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥æœåŠ¡å™¨è¿æ¥: ' + err.message, 'error');
      }
    }

    async function loadLiteratureList() {
      const username = sessionStorage.getItem('username') || localStorage.getItem('username');
      if (!username) {
        return;
      }

      try {
        const res = await fetch(`${BASE_URL}/getLiterature?username=` + encodeURIComponent(username));
        const data = await res.json();
        if (!data.success) {
          console.warn('æ‹‰å–æ–‡çŒ®è®°å½•å¤±è´¥', data);
          return;
        }
        renderLiteratureHistory(data.data || []);
      } catch (err) {
        console.error('åŠ è½½æ–‡çŒ®è®°å½•å‡ºé”™ï¼š', err);
      }
    }

    function renderLiteratureHistory(list) {
      const containerId = 'literatureHistoryContainer';
      let container = document.getElementById(containerId);
      const parent = document.getElementById('newcard4');
      if (!parent) return;

      if (!container) {
        container = document.createElement('div');
        container.id = containerId;
        container.style.width = '80%';
        container.style.margin = '20px auto';
        container.style.padding = '12px';
        container.style.borderTop = '1px dashed #acc3e3';
        container.style.textAlign = 'left';
        container.style.color = '#033d94';
        parent.appendChild(container);
      }

      container.innerHTML = '<h3 style="color:#0348b0;margin-bottom:8px;">å†å²æ–‡çŒ®è®°å½•ï¼ˆæœ€è¿‘ï¼‰</h3>';

      if (!list || list.length === 0) {
        const p = document.createElement('p');
        p.textContent = 'æš‚æ— æ–‡çŒ®è®°å½•ã€‚';
        p.style.color = '#666';
        container.appendChild(p);
        return;
      }

      const maxShow = 10;
      list.slice(0, maxShow).forEach(item => {
        const entry = document.createElement('div');
        entry.style.padding = '8px 0';
        entry.style.borderBottom = '1px solid #eee';

        const title = document.createElement('div');
        title.style.fontWeight = '700';
        title.style.marginBottom = '4px';
        const dateStr = item.created_at ? (' ' + (item.created_at.includes('T') ? item.created_at.split('T')[0] : item.created_at)) : '';
        title.textContent = `${item.title || '(æ— æ ‡é¢˜)'}${dateStr}`;

        const small = document.createElement('div');
        small.style.fontSize = '13px';
        small.style.color = '#333';

        small.innerHTML = `\n          <div><strong>ä½œè€…ï¼š</strong>${escapeHtml(item.authors || '-')}</div>\n          <div><strong>æœŸåˆŠ/ä¼šè®®ï¼š</strong>${escapeHtml(item.journal || '-')} ${item.year ? '(' + escapeHtml(item.year) + ')' : ''}</div>\n          <div><strong>å…³é”®è¯ï¼š</strong>${escapeHtml(item.keywords || '-')}</div>\n          <div><strong>é“¾æ¥ï¼š</strong>${item.link ? ('<a href="' + escapeHtml(item.link) + '" target="_blank" rel="noopener noreferrer">' + escapeHtml(item.link) + '</a>') : '-'}</div>\n          <div><strong>å¤‡æ³¨ï¼š</strong>${escapeHtml(item.notes || '-')}</div>\n\n        `;

        entry.appendChild(title);
        entry.appendChild(small);
        container.appendChild(entry);
      });

      if (list.length > maxShow) {
        const more = document.createElement('div');
        more.style.textAlign = 'center';
        more.style.marginTop = '8px';
        more.innerHTML = `<small style="color:#666">... å…± ${list.length} æ¡å†å²ï¼ˆä»…æ˜¾ç¤ºæœ€è¿‘ ${maxShow} æ¡ï¼‰</small>`;
        container.appendChild(more);
      }
    }

    const literatureForm = document.getElementById('literatureForm');
    if (literatureForm) {
      literatureForm.addEventListener('submit', function (e) {
        e.preventDefault();
        saveLiterature();
      });
    } else {
      console.error('æœªæ‰¾åˆ° literatureForm è¡¨å•');
    }

    const cardFourth = document.querySelectorAll('.card')[2];
    if (cardFourth) {
      cardFourth.addEventListener('click', () => {
        setTimeout(loadLiteratureList, 120);
      });
    }
  </script>

  <script>
    /* ====== æ—¥å¿—ç›¸å…³ï¼šä¿å­˜å¹¶åŒæ­¥åˆ°åç«¯ ======
       è¯´æ˜ï¼šå°†æ—¥å¿—æäº¤åˆ° /addLogï¼ŒåŠ è½½æ—¶ä¼šæ‹‰å–ç”¨æˆ·æ—¥å¿—å¹¶æ¸²æŸ“ã€‚ */

    async function saveLogToServer(content, title = null) {
      const username = sessionStorage.getItem('username') || localStorage.getItem('username');
      if (!username) {
        showMessage('æœªæ£€æµ‹åˆ°ç™»å½•ç”¨æˆ·ï¼Œè¯·å…ˆç™»å½•', 'error');
        return { success: false, error: 'æœªç™»å½•' };
      }

      try {
        const res = await fetch(`${BASE_URL}/addLog`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ username, title, content })
        });
        const data = await res.json();
        return data;
      } catch (err) {
        console.error('ä¿å­˜æ—¥å¿—å‡ºé”™:', err);
        return { success: false, error: err.message || 'ç½‘ç»œé”™è¯¯' };
      }
    }

    function formatDateTime(dateStr) {
      if (!dateStr) return '';
      const d = new Date(dateStr);
      const yyyy = d.getFullYear();
      const mm = String(d.getMonth() + 1).padStart(2, '0');
      const dd = String(d.getDate()).padStart(2, '0');
      return `${yyyy}-${mm}-${dd}`;
    }

    // å°†å•æ¡æ—¥å¿—æ¸²æŸ“åˆ°å·¦ä¾§æ—¥å¿—å®¹å™¨é¡¶éƒ¨ï¼ˆç”¨äºå³æ—¶æ˜¾ç¤ºæ–°ä¿å­˜çš„æ—¥å¿—ï¼‰
    function prependLogToUI(log) {
      const container = document.querySelector('#log-container .log-content');
      if (!container) return;

      const entry = document.createElement('div');
      entry.className = 'log-entry';
      entry.innerHTML = `\n    <h4>${log.title ? escapeHtml(log.title) : 'ä¸ªäººæ—¥å¿—'} \n      <small style="font-weight:600;color:#666;margin-left:8px;font-size:12px">\n        ${formatDateTime(log.created_at || log.log_date)}\n      </small>\n    </h4>\n    <p>${escapeHtml(log.content)}</p>\n  `;

      container.insertBefore(entry, container.firstChild);
    }

    // é¡µé¢åŠ è½½æ—¶æ‹‰å–å¹¶æ¸²æŸ“å†å²æ—¥å¿—
    async function loadUserLogs() {
      const username = sessionStorage.getItem('username') || localStorage.getItem('username');
      if (!username) {
        return;
      }
      try {
        const res = await fetch(`${BASE_URL}/getLogs?username=` + encodeURIComponent(username));
        const data = await res.json();
        if (!data.success) { console.warn('æ‹‰å–æ—¥å¿—å¤±è´¥', data); return; }
        const list = data.data || [];
        const container = document.querySelector('#log-container .log-content');
        if (!container) return;

        container.innerHTML = '';
        if (list.length === 0) {
          container.innerHTML = '<div class="log-entry"><h4>æš‚æ— æ—¥å¿—</h4><p>å°šæœªåˆ›å»ºä»»ä½•æ—¥å¿—</p></div>';
          return;
        }

        list.forEach(item => {
          const entry = document.createElement('div');
          entry.className = 'log-entry';
          entry.innerHTML = `\n    <h4>${item.title ? escapeHtml(item.title) : 'ä¸ªäººæ—¥å¿—'} \n      <small style="font-weight:600;color:#666;margin-left:8px;font-size:12px">\n        ${formatDateTime(item.created_at || item.log_date)}\n      </small>\n    </h4>\n    <p>${escapeHtml(item.content)}</p>\n  `;
          container.appendChild(entry);
        });

      } catch (err) {
        console.error('åŠ è½½æ—¥å¿—å¤±è´¥ï¼š', err);
      }
    }

    // ç®€å•çš„å‰ç«¯è½¬ä¹‰å‡½æ•°ï¼Œç”¨äºé˜²æ­¢æ˜¾ç¤ºæ—¶çš„ HTML æ³¨å…¥ï¼ˆä»…ç”¨äºå±•ç¤ºï¼‰
    function escapeHtml(str) {
      if (!str && str !== 0) return '';
      return String(str)
        .replaceAll('&', '&amp;')
        .replaceAll('<', '&lt;')
        .replaceAll('>', '&gt;')
        .replaceAll('"', '&quot;')
        .replaceAll("'", '&#39;')
        .replaceAll('\n', '<br>');
    }

    // ç»‘å®šæ—¥å¿—ä¿å­˜æŒ‰é’®ï¼šæäº¤å¹¶åœ¨æˆåŠŸåå°†æ—¥å¿—å³æ—¶æ¸²æŸ“åˆ°ç•Œé¢
    document.getElementById('save-log').addEventListener('click', async function () {
      const contentEl = document.getElementById('log-input');
      const content = contentEl.value.trim();
      if (!content) {
        showMessage('æ—¥å¿—å†…å®¹ä¸èƒ½ä¸ºç©º', 'error');
        return;
      }
      showMessage('æ­£åœ¨ä¿å­˜æ—¥å¿—...', 'info');
      const result = await saveLogToServer(content, null);
      if (result && result.success) {
        showMessage('æ—¥å¿—ä¿å­˜æˆåŠŸ', 'success');
        contentEl.value = '';
        if (result.log) prependLogToUI(result.log);
      } else {
        showMessage('ä¿å­˜å¤±è´¥ï¼š' + (result.error || 'æœªçŸ¥é”™è¯¯'), 'error');
      }
    });

    window.addEventListener('load', function () {
      loadUserLogs();
    });
  </script>
</body>


</html>
